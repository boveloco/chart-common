name: Deploy Helm Chart

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Helm
      uses: azure/setup-helm@v1
      with:
        version: 'v3.5.4'

    - name: Package Helm Chart
      run: helm package chart

    - name: Push Helm Chart to GitHub Registry
      env:
        CR_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        helm registry login ghcr.io -u ${{ github.actor }} --password $CR_TOKEN
        helm push common-0.1.0.tgz https://ghcr.io/${{ github.repository_owner }}/helm-charts